# WebFrame

## 框架概述

WebFrame 是一个使用 Go 语言开发的全功能 Web 应用框架。框架集成了路由、中间件、ORM、会话管理、模板引擎等核心组件，同时提供了丰富的扩展功能，如监控、缓存、连接池管理等。

## 核心特性

### 灵活的路由系统
- **多种路由模式**：支持静态路由、参数路由（`:id`）、正则路由（`:id([0-9]+)`）和通配符路由（`*`）
- **路由分组**：支持嵌套路由组，便于API版本管理和模块化
- **优先级匹配**：智能路由匹配逻辑，确保最精确的路由模式优先匹配
- **路由元数据**：支持为路由附加额外信息，便于权限控制和文档生成

### 完善的中间件体系
- **灵活的位置控制**：支持全局中间件、路由组中间件和单路由中间件
- **丰富的内置中间件**：包括访问日志、请求跟踪、指标收集、错误恢复等
- **执行顺序控制**：精确控制中间件链的执行顺序
- **中间件条件**：支持基于请求条件动态启用中间件

### 全面的ORM支持
- **多数据库支持**：内置MySQL、PostgreSQL、SQLite方言支持
- **链式查询API**：直观的查询构建方式，支持复杂查询场景
- **事务管理**：简化的事务操作，支持嵌套事务
- **数据分片**：内置数据库分片能力，支持水平扩展
- **查询缓存**：智能查询缓存，提高读操作性能
- **连接池管理**：高效的数据库连接管理
- **自动迁移**：模型定义变更自动同步到数据库结构

### 高效的会话管理
- **多种存储后端**：支持内存、Redis等多种会话存储方案
- **Cookie传播器**：便捷的Cookie会话管理
- **会话超时控制**：可配置的会话生命周期管理
- **分布式会话**：支持跨服务器的会话共享

### 完整的模板引擎
- **基于Go模板**：兼容Go标准库模板，学习成本低
- **布局系统**：支持模板继承和布局复用
- **自动重载**：开发模式下支持模板文件变更自动重载
- **丰富的辅助函数**：提供常用模板函数，简化视图开发

### 可观测性设计
- **结构化日志**：详细的请求处理日志记录
- **性能指标**：集成Prometheus监控，收集关键性能指标
- **分布式追踪**：OpenTelemetry集成，支持链路追踪
- **健康检查**：内置健康检查端点，便于部署和监控

## 架构设计

WebFrame 采用分层设计，各层次职责明确，便于理解和扩展：

```
+------------------------------------------------------------------+
|                        应用层 (用户代码)                           |
+------------------------------------------------------------------+
                |                    |                  |
                v                    v                  v
+----------------+    +----------------+    +---------------+
|   HTTP服务器   |    |    模板引擎     |    |   静态资源    |
+----------------+    +----------------+    +---------------+
        |                     |                    |
        v                     v                    v
+------------------------------------------------------------------+
|                           核心层                                 |
|                                                                  |
|  +-------------+  +------------+  +------------+  +------------+ |
|  |   路由系统   |  |  中间件链  |  | 上下文管理 |  | 请求/响应  | |
|  +-------------+  +------------+  +------------+  +------------+ |
|                                                                  |
+------------------------------------------------------------------+
                |                    |                  |
                v                    v                  v
+---------------+    +---------------+    +---------------+
|   会话管理    |    |      ORM      |    |   连接池管理   |
+---------------+    +---------------+    +---------------+
        |                  |                     |
        v                  v                     v
+----------------+    +----------------+    +---------------+
| Cookie/Redis会话|    | MySQL/PG/SQLite|    |    连接池     |
+----------------+    +----------------+    +---------------+
```

## 核心模块介绍

### Web服务器 (web/)
- **Server**: HTTP服务器核心，处理请求路由和分发
- **Router**: 路由系统，支持多种路由模式和路由组
- **Context**: 请求上下文，封装请求和响应操作
- **Middleware**: 中间件系统，提供请求处理管道
- **Response**: 响应处理，支持多种响应格式

### 中间件模块 (web/middleware/)
- **accesslog**: 请求访问日志记录
- **recovery**: 错误恢复，防止服务崩溃
- **prometheus**: 性能指标收集和导出
- **opentracing**: 分布式链路追踪
- **session**: 会话管理中间件

### 会话管理 (web/session/)
- **Manager**: 会话管理器，协调会话的创建、查找和刷新
- **Storage**: 会话存储接口，定义会话数据的持久化
- **Propagator**: 会话传播器，负责会话ID的传递
- **redissession**: Redis会话存储实现
- **cookiepropagator**: Cookie会话传播实现

### ORM框架 (orm/)
- **DB**: 数据库连接和操作核心
- **Model**: 数据模型定义和元数据
- **Query**: 查询构建和执行
- **Transaction**: 事务管理和执行
- **Middleware**: ORM中间件，支持缓存、分片等扩展功能
- **Migration**: 数据库迁移工具
- **Cache**: 查询缓存系统
- **Sharding**: 数据库分片管理

### 模板引擎 (web/)
- **Template**: 模板引擎接口，定义模板渲染行为
- **GoTemplate**: 基于Go标准库的模板引擎实现
- **StaticResource**: 静态资源管理和服务
- **File**: 文件上传下载处理

### 工具链 (scaffold/)
- **Templates**: 脚手架模板，用于生成项目结构和示例代码
- **Scaffolder**: 项目脚手架，快速创建新项目
