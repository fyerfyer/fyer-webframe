"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[153],{972:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"orm/migration/migrate","title":"Data Migration","description":"WebFrame ORM \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u6570\u636e\u8fc1\u79fb\u529f\u80fd\uff0c\u5e2e\u52a9\u60a8\u81ea\u52a8\u521b\u5efa\u548c\u66f4\u65b0\u6570\u636e\u5e93\u8868\u7ed3\u6784\u4ee5\u5339\u914d Go \u7ed3\u6784\u4f53\u5b9a\u4e49\u3002","source":"@site/docs/orm/migration/migrate.md","sourceDirName":"orm/migration","slug":"/orm/migration/migrate","permalink":"/fyer-webframe/docs/orm/migration/migrate","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-webframe/tree/main/docs/orm/migration/migrate.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/fyer-webframe/docs/orm/getting-started/started"},"next":{"title":"Select Build","permalink":"/fyer-webframe/docs/orm/selector/select"}}');var d=n(4848),i=n(8453);const t={},s="Data Migration",c={},o=[{value:"\u81ea\u52a8\u8fc1\u79fb",id:"\u81ea\u52a8\u8fc1\u79fb",level:2},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:3},{value:"\u81ea\u52a8\u8fc1\u79fb\u591a\u4e2a\u6a21\u578b",id:"\u81ea\u52a8\u8fc1\u79fb\u591a\u4e2a\u6a21\u578b",level:3},{value:"\u8fc1\u79fb\u9009\u9879",id:"\u8fc1\u79fb\u9009\u9879",level:3},{value:"\u6ce8\u518c\u6a21\u578b\u5e76\u81ea\u52a8\u8fc1\u79fb",id:"\u6ce8\u518c\u6a21\u578b\u5e76\u81ea\u52a8\u8fc1\u79fb",level:3},{value:"\u8bd5\u8fd0\u884c\u6a21\u5f0f",id:"\u8bd5\u8fd0\u884c\u6a21\u5f0f",level:3},{value:"\u8fc1\u79fb\u7b56\u7565",id:"\u8fc1\u79fb\u7b56\u7565",level:2},{value:"1. CreateOnly \u7b56\u7565",id:"1-createonly-\u7b56\u7565",level:3},{value:"2. AlterIfNeeded \u7b56\u7565",id:"2-alterifneeded-\u7b56\u7565",level:3},{value:"3. DropAndCreateIfChanged \u7b56\u7565",id:"3-dropandcreateifchanged-\u7b56\u7565",level:3},{value:"4. ForceRecreate \u7b56\u7565",id:"4-forcerecreate-\u7b56\u7565",level:3},{value:"\u7b56\u7565\u9009\u62e9\u6307\u5357",id:"\u7b56\u7565\u9009\u62e9\u6307\u5357",level:3},{value:"\u8fc1\u79fb\u65e5\u5fd7",id:"\u8fc1\u79fb\u65e5\u5fd7",level:2},{value:"\u542f\u7528\u8fc1\u79fb\u65e5\u5fd7",id:"\u542f\u7528\u8fc1\u79fb\u65e5\u5fd7",level:3},{value:"\u8fc1\u79fb\u56de\u8c03",id:"\u8fc1\u79fb\u56de\u8c03",level:3},{value:"\u9ad8\u7ea7\u8fc1\u79fb\u573a\u666f",id:"\u9ad8\u7ea7\u8fc1\u79fb\u573a\u666f",level:2},{value:"\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\u5e93\u65b9\u8a00",id:"\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\u5e93\u65b9\u8a00",level:3},{value:"\u5904\u7406\u590d\u6742\u7684\u8868\u7ed3\u6784\u53d8\u66f4",id:"\u5904\u7406\u590d\u6742\u7684\u8868\u7ed3\u6784\u53d8\u66f4",level:3},{value:"\u8fc1\u79fb\u9650\u5236",id:"\u8fc1\u79fb\u9650\u5236",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.header,{children:(0,d.jsx)(r.h1,{id:"data-migration",children:"Data Migration"})}),"\n",(0,d.jsx)(r.p,{children:"WebFrame ORM \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u6570\u636e\u8fc1\u79fb\u529f\u80fd\uff0c\u5e2e\u52a9\u60a8\u81ea\u52a8\u521b\u5efa\u548c\u66f4\u65b0\u6570\u636e\u5e93\u8868\u7ed3\u6784\u4ee5\u5339\u914d Go \u7ed3\u6784\u4f53\u5b9a\u4e49\u3002"}),"\n",(0,d.jsx)(r.h2,{id:"\u81ea\u52a8\u8fc1\u79fb",children:"\u81ea\u52a8\u8fc1\u79fb"}),"\n",(0,d.jsx)(r.p,{children:"\u81ea\u52a8\u8fc1\u79fb\u662f WebFrame ORM \u7684\u6838\u5fc3\u529f\u80fd\u4e4b\u4e00\uff0c\u5b83\u80fd\u591f\u6839\u636e\u5b9a\u4e49\u7684 Go \u7ed3\u6784\u4f53\u6a21\u578b\u81ea\u52a8\u521b\u5efa\u548c\u66f4\u65b0\u6570\u636e\u5e93\u8868\u7ed3\u6784\u3002"}),"\n",(0,d.jsx)(r.h3,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,d.jsxs)(r.p,{children:["\u6700\u7b80\u5355\u7684\u81ea\u52a8\u8fc1\u79fb\u65b9\u5f0f\u662f\u4f7f\u7528 ",(0,d.jsx)(r.code,{children:"AutoMigrate"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'package main\r\n\r\nimport (\r\n    "context"\r\n    "log"\r\n    "time"\r\n\r\n    "github.com/fyerfyer/fyer-webframe/orm"\r\n)\r\n\r\n// \u7528\u6237\u6a21\u578b\r\ntype User struct {\r\n    ID        int       `orm:"primary_key;auto_increment"`\r\n    Name      string    `orm:"size:255;index"`\r\n    Email     string    `orm:"size:255;unique"`\r\n    Age       int       `orm:"nullable:false;default:18"`\r\n    CreatedAt time.Time `orm:"nullable:false"`\r\n    UpdatedAt time.Time\r\n    DeletedAt sql.NullTime\r\n}\r\n\r\nfunc main() {\r\n    // \u8fde\u63a5\u6570\u636e\u5e93\r\n    db, err := orm.OpenDB("mysql", "user:password@tcp(localhost:3306)/testdb", "mysql")\r\n    if err != nil {\r\n        log.Fatal(err)\r\n    }\r\n    defer db.Close()\r\n\r\n    // \u6267\u884c\u81ea\u52a8\u8fc1\u79fb\r\n    err = db.MigrateModel(context.Background(), &User{})\r\n    if err != nil {\r\n        log.Fatal(err)\r\n    }\r\n\r\n    log.Println("Migration completed successfully")\r\n}\n'})}),"\n",(0,d.jsx)(r.h3,{id:"\u81ea\u52a8\u8fc1\u79fb\u591a\u4e2a\u6a21\u578b",children:"\u81ea\u52a8\u8fc1\u79fb\u591a\u4e2a\u6a21\u578b"}),"\n",(0,d.jsx)(r.p,{children:"\u53ef\u4ee5\u540c\u65f6\u8fc1\u79fb\u591a\u4e2a\u6a21\u578b\uff1a"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// \u5b9a\u4e49\u591a\u4e2a\u6a21\u578b\r\ntype Product struct {\r\n    ID          int     `orm:"primary_key;auto_increment"`\r\n    Name        string  `orm:"size:255;nullable:false"`\r\n    Price       float64 `orm:"nullable:false"`\r\n    Description string  `orm:"size:1000"`\r\n}\r\n\r\ntype Category struct {\r\n    ID   int    `orm:"primary_key;auto_increment"`\r\n    Name string `orm:"size:255;unique"`\r\n}\r\n\r\n// \u8fc1\u79fb\u591a\u4e2a\u6a21\u578b\r\nerr = db.MigrateAll(context.Background(), orm.WithStrategy(orm.AlterIfNeeded))\n'})}),"\n",(0,d.jsx)(r.h3,{id:"\u8fc1\u79fb\u9009\u9879",children:"\u8fc1\u79fb\u9009\u9879"}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"MigrateModel"})," \u548c ",(0,d.jsx)(r.code,{children:"MigrateAll"})," \u65b9\u6cd5\u652f\u6301\u591a\u79cd\u9009\u9879\u6765\u81ea\u5b9a\u4e49\u8fc1\u79fb\u884c\u4e3a\uff1a"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// \u4f7f\u7528\u9009\u9879\u8fdb\u884c\u8fc1\u79fb\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    // \u6307\u5b9a\u8fc1\u79fb\u7b56\u7565\r\n    orm.WithStrategy(orm.AlterIfNeeded),\r\n    // \u542f\u7528\u8fc1\u79fb\u65e5\u5fd7\r\n    orm.WithMigrationLog(true),\r\n    // \u6307\u5b9a\u6570\u636e\u5e93Schema (\u4ec5PostgreSQL\u7b49\u652f\u6301schema\u7684\u6570\u636e\u5e93\u6709\u6548)\r\n    orm.WithSchema("public"),\r\n    // \u8fc1\u79fb\u5b8c\u6210\u540e\u56de\u8c03\r\n    orm.WithMigrationCallback(func(m *orm.Migration) {\r\n        log.Printf("Migrated model: %s, version: %d", m.ModelName, m.Version)\r\n    }),\r\n)\n'})}),"\n",(0,d.jsx)(r.h3,{id:"\u6ce8\u518c\u6a21\u578b\u5e76\u81ea\u52a8\u8fc1\u79fb",children:"\u6ce8\u518c\u6a21\u578b\u5e76\u81ea\u52a8\u8fc1\u79fb"}),"\n",(0,d.jsx)(r.p,{children:"WebFrame ORM \u5141\u8bb8\u5728\u6ce8\u518c\u6a21\u578b\u540c\u65f6\u8fdb\u884c\u81ea\u52a8\u8fc1\u79fb\uff1a"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// \u6ce8\u518c\u6a21\u578b\u5e76\u81ea\u52a8\u8fc1\u79fb\r\ndb.RegisterModel("User", &User{}, orm.WithStrategy(orm.AlterIfNeeded))\r\n\r\n// \u6ce8\u518c\u591a\u4e2a\u6a21\u578b\r\ndb.RegisterModels(map[string]interface{}{\r\n    "User":     &User{},\r\n    "Product":  &Product{},\r\n    "Category": &Category{},\r\n}, orm.WithStrategy(orm.AlterIfNeeded))\n'})}),"\n",(0,d.jsx)(r.h3,{id:"\u8bd5\u8fd0\u884c\u6a21\u5f0f",children:"\u8bd5\u8fd0\u884c\u6a21\u5f0f"}),"\n",(0,d.jsx)(r.p,{children:"\u8bd5\u8fd0\u884c\u6a21\u5f0f\u5141\u8bb8\u67e5\u770b\u8fc1\u79fb\u5c06\u6267\u884c\u7684 SQL \u8bed\u53e5\uff0c\u800c\u4e0d\u5b9e\u9645\u6267\u884c\u5b83\u4eec\uff1a"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// \u4f7f\u7528\u8bd5\u8fd0\u884c\u6a21\u5f0f\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithDryRun(true),\r\n    orm.WithMigrationCallback(func(m *orm.Migration) {\r\n        // \u6b64\u56de\u8c03\u4f1a\u5305\u542b\u5c06\u8981\u6267\u884c\u7684 DDL \u8bed\u53e5\r\n        log.Printf("Would execute: %s", m.DDL)\r\n    }),\r\n)\n'})}),"\n",(0,d.jsx)(r.h2,{id:"\u8fc1\u79fb\u7b56\u7565",children:"\u8fc1\u79fb\u7b56\u7565"}),"\n",(0,d.jsx)(r.p,{children:"WebFrame ORM \u63d0\u4f9b\u4e86\u591a\u79cd\u8fc1\u79fb\u7b56\u7565\uff0c\u4ee5\u6ee1\u8db3\u4e0d\u540c\u7684\u5f00\u53d1\u548c\u90e8\u7f72\u573a\u666f\u9700\u6c42\u3002\u6bcf\u79cd\u7b56\u7565\u90fd\u6709\u5176\u7279\u5b9a\u7684\u7528\u9014\u548c\u884c\u4e3a\u3002"}),"\n",(0,d.jsx)(r.h3,{id:"1-createonly-\u7b56\u7565",children:"1. CreateOnly \u7b56\u7565"}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"CreateOnly"})," \u7b56\u7565\u4ec5\u521b\u5efa\u65b0\u8868\uff0c\u4e0d\u4fee\u6539\u5df2\u5b58\u5728\u7684\u8868\u3002\u8fd9\u662f\u6700\u5b89\u5168\u7684\u7b56\u7565\uff0c\u9002\u5408\u751f\u4ea7\u73af\u5883\u3002"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:"// \u4f7f\u7528 CreateOnly \u7b56\u7565\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithStrategy(orm.CreateOnly),\r\n)\n"})}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"\u751f\u4ea7\u73af\u5883\u4e2d\u5b89\u5168\u5730\u6dfb\u52a0\u65b0\u8868"}),"\n",(0,d.jsx)(r.li,{children:"\u5f53\u60a8\u4e0d\u5e0c\u671b\u4fee\u6539\u4efb\u4f55\u73b0\u6709\u8868\u7ed3\u6784\u65f6"}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"2-alterifneeded-\u7b56\u7565",children:"2. AlterIfNeeded \u7b56\u7565"}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"AlterIfNeeded"})," \u7b56\u7565\u4f1a\u6839\u636e\u9700\u8981\u4fee\u6539\u73b0\u6709\u8868\u7ed3\u6784\uff0c\u5982\u6dfb\u52a0\u5217\u6216\u4fee\u6539\u5217\u5b9a\u4e49\u3002"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:"// \u4f7f\u7528 AlterIfNeeded \u7b56\u7565\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithStrategy(orm.AlterIfNeeded),\r\n)\n"})}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"\u5f00\u53d1\u73af\u5883\u4e2d\u9010\u6b65\u66f4\u65b0\u8868\u7ed3\u6784"}),"\n",(0,d.jsx)(r.li,{children:"\u9700\u8981\u5728\u4e0d\u4e22\u5931\u6570\u636e\u7684\u60c5\u51b5\u4e0b\u66f4\u65b0\u8868\u7ed3\u6784\u65f6"}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"3-dropandcreateifchanged-\u7b56\u7565",children:"3. DropAndCreateIfChanged \u7b56\u7565"}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"DropAndCreateIfChanged"})," \u7b56\u7565\u5728\u68c0\u6d4b\u5230\u8868\u7ed3\u6784\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4f1a\u5220\u9664\u5e76\u91cd\u65b0\u521b\u5efa\u8868\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:"// \u4f7f\u7528 DropAndCreateIfChanged \u7b56\u7565\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithStrategy(orm.DropAndCreateIfChanged),\r\n)\n"})}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"\u5f00\u53d1\u73af\u5883\u4e2d\u9891\u7e41\u66f4\u6539\u8868\u7ed3\u6784"}),"\n",(0,d.jsx)(r.li,{children:"\u6d4b\u8bd5\u73af\u5883\u4e2d\u9700\u8981\u4fdd\u6301\u8868\u7ed3\u6784\u4e0e\u6a21\u578b\u5b8c\u5168\u4e00\u81f4"}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"4-forcerecreate-\u7b56\u7565",children:"4. ForceRecreate \u7b56\u7565"}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"ForceRecreate"})," \u7b56\u7565\u5f3a\u5236\u5220\u9664\u5e76\u91cd\u65b0\u521b\u5efa\u6240\u6709\u8868\uff0c\u65e0\u8bba\u8868\u7ed3\u6784\u662f\u5426\u53d8\u5316\u3002\u8fd9\u5c06\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:"// \u4f7f\u7528 ForceRecreate \u7b56\u7565\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithStrategy(orm.ForceRecreate),\r\n)\n"})}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a"]}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsx)(r.li,{children:"\u5f00\u53d1\u73af\u5883\u4e2d\u5b8c\u5168\u91cd\u7f6e\u6570\u636e\u5e93"}),"\n",(0,d.jsx)(r.li,{children:"\u5355\u5143\u6d4b\u8bd5\uff0c\u9700\u8981\u6bcf\u6b21\u6d4b\u8bd5\u524d\u91cd\u7f6e\u6570\u636e\u5e93\u72b6\u6001"}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"\u7b56\u7565\u9009\u62e9\u6307\u5357",children:"\u7b56\u7565\u9009\u62e9\u6307\u5357"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"\u7b56\u7565"}),(0,d.jsx)(r.th,{children:"\u6570\u636e\u5b89\u5168\u6027"}),(0,d.jsx)(r.th,{children:"\u9002\u7528\u73af\u5883"}),(0,d.jsx)(r.th,{children:"\u5907\u6ce8"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"CreateOnly"})}),(0,d.jsx)(r.td,{children:"\u6700\u9ad8"}),(0,d.jsx)(r.td,{children:"\u751f\u4ea7\u73af\u5883"}),(0,d.jsx)(r.td,{children:"\u53ea\u521b\u5efa\u65b0\u8868\uff0c\u4e0d\u4fee\u6539\u73b0\u6709\u8868"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"AlterIfNeeded"})}),(0,d.jsx)(r.td,{children:"\u4e2d\u7b49"}),(0,d.jsx)(r.td,{children:"\u5f00\u53d1/\u6d4b\u8bd5"}),(0,d.jsx)(r.td,{children:"\u6839\u636e\u9700\u8981\u4fee\u6539\u8868\u7ed3\u6784\uff0c\u5c1d\u8bd5\u4fdd\u7559\u6570\u636e"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DropAndCreateIfChanged"})}),(0,d.jsx)(r.td,{children:"\u4f4e"}),(0,d.jsx)(r.td,{children:"\u5f00\u53d1"}),(0,d.jsx)(r.td,{children:"\u8868\u7ed3\u6784\u53d8\u5316\u65f6\u5220\u9664\u5e76\u91cd\u5efa\u8868"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"ForceRecreate"})}),(0,d.jsx)(r.td,{children:"\u6700\u4f4e"}),(0,d.jsx)(r.td,{children:"\u5f00\u53d1/\u6d4b\u8bd5"}),(0,d.jsx)(r.td,{children:"\u5f3a\u5236\u91cd\u5efa\u6240\u6709\u8868\uff0c\u603b\u662f\u5220\u9664\u6570\u636e"})]})]})]}),"\n",(0,d.jsx)(r.h2,{id:"\u8fc1\u79fb\u65e5\u5fd7",children:"\u8fc1\u79fb\u65e5\u5fd7"}),"\n",(0,d.jsx)(r.p,{children:"WebFrame ORM \u53ef\u4ee5\u7ef4\u62a4\u8fc1\u79fb\u64cd\u4f5c\u7684\u65e5\u5fd7\uff0c\u8bb0\u5f55\u6bcf\u6b21\u6a21\u5f0f\u53d8\u66f4\uff0c\u8fd9\u5bf9\u4e8e\u8ffd\u8e2a\u6570\u636e\u5e93\u5386\u53f2\u53d8\u66f4\u975e\u5e38\u6709\u7528\u3002"}),"\n",(0,d.jsx)(r.h3,{id:"\u542f\u7528\u8fc1\u79fb\u65e5\u5fd7",children:"\u542f\u7528\u8fc1\u79fb\u65e5\u5fd7"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:"// \u542f\u7528\u8fc1\u79fb\u65e5\u5fd7\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithMigrationLog(true),\r\n)\n"})}),"\n",(0,d.jsxs)(r.p,{children:["\u542f\u7528\u540e\uff0cORM \u4f1a\u521b\u5efa\u4e00\u4e2a ",(0,d.jsx)(r.code,{children:"migration_logs"})," \u8868\u6765\u8ddf\u8e2a\u6240\u6709\u8fc1\u79fb\u64cd\u4f5c\uff0c\u5305\u542b\u4ee5\u4e0b\u4fe1\u606f\uff1a"]}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"\u6a21\u578b\u540d\u79f0"}),"\uff1a\u88ab\u8fc1\u79fb\u7684\u6a21\u578b"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"\u8868\u540d"}),"\uff1a\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u8868"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"\u7248\u672c\u53f7"}),"\uff1a\u8fc1\u79fb\u7248\u672c"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"\u521b\u5efa\u65f6\u95f4"}),"\uff1a\u8fc1\u79fb\u8bb0\u5f55\u521b\u5efa\u65f6\u95f4"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"\u5e94\u7528\u65f6\u95f4"}),"\uff1a\u8fc1\u79fb\u5b9e\u9645\u6267\u884c\u65f6\u95f4"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"DDL \u8bed\u53e5"}),"\uff1a\u6267\u884c\u7684 DDL \u8bed\u53e5"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"\u6821\u9a8c\u548c"}),"\uff1aDDL \u8bed\u53e5\u7684\u6821\u9a8c\u548c\uff0c\u7528\u4e8e\u68c0\u6d4b\u53d8\u5316"]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"\u8fc1\u79fb\u56de\u8c03",children:"\u8fc1\u79fb\u56de\u8c03"}),"\n",(0,d.jsx)(r.p,{children:"\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u53ef\u4ee5\u5728\u8fc1\u79fb\u64cd\u4f5c\u5b8c\u6210\u540e\u6267\u884c\u81ea\u5b9a\u4e49\u903b\u8f91\uff1a"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// \u4f7f\u7528\u8fc1\u79fb\u56de\u8c03\r\nerr = db.MigrateModel(\r\n    context.Background(),\r\n    &User{},\r\n    orm.WithMigrationCallback(func(m *orm.Migration) {\r\n        // \u8bb0\u5f55\u8fc1\u79fb\u4fe1\u606f\r\n        log.Printf("Migrated: %s (v%d) at %v", m.ModelName, m.Version, m.AppliedAt)\r\n        log.Printf("DDL: %s", m.DDL)\r\n    }),\r\n)\n'})}),"\n",(0,d.jsx)(r.h2,{id:"\u9ad8\u7ea7\u8fc1\u79fb\u573a\u666f",children:"\u9ad8\u7ea7\u8fc1\u79fb\u573a\u666f"}),"\n",(0,d.jsx)(r.h3,{id:"\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\u5e93\u65b9\u8a00",children:"\u5904\u7406\u4e0d\u540c\u7684\u6570\u636e\u5e93\u65b9\u8a00"}),"\n",(0,d.jsx)(r.p,{children:"\u6bcf\u79cd\u6570\u636e\u5e93\u65b9\u8a00\u5728\u8fc1\u79fb\u65f6\u751f\u6210\u7684 DDL \u8bed\u53e5\u53ef\u80fd\u4e0d\u540c\u3002WebFrame ORM \u4f1a\u6839\u636e\u60a8\u4f7f\u7528\u7684\u65b9\u8a00\u751f\u6210\u9002\u5f53\u7684 SQL\uff1a"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// MySQL \u65b9\u8a00\r\ndbMySQL, _ := orm.OpenDB("mysql", "user:password@tcp(localhost:3306)/testdb", "mysql")\r\nerr = dbMySQL.MigrateModel(context.Background(), &User{})\r\n\r\n// PostgreSQL \u65b9\u8a00 \r\ndbPG, _ := orm.OpenDB("postgres", "postgres://user:password@localhost/testdb", "postgresql")\r\nerr = dbPG.MigrateModel(context.Background(), &User{})\r\n\r\n// SQLite \u65b9\u8a00\r\ndbSQLite, _ := orm.OpenDB("sqlite3", "file:test.db", "sqlite")\r\nerr = dbSQLite.MigrateModel(context.Background(), &User{})\n'})}),"\n",(0,d.jsx)(r.h3,{id:"\u5904\u7406\u590d\u6742\u7684\u8868\u7ed3\u6784\u53d8\u66f4",children:"\u5904\u7406\u590d\u6742\u7684\u8868\u7ed3\u6784\u53d8\u66f4"}),"\n",(0,d.jsx)(r.p,{children:"\u67d0\u4e9b\u590d\u6742\u7684\u8868\u7ed3\u6784\u53d8\u66f4\uff08\u5982\u91cd\u547d\u540d\u5217\u3001\u66f4\u6539\u5217\u7c7b\u578b\uff09\u53ef\u80fd\u65e0\u6cd5\u901a\u8fc7\u81ea\u52a8\u8fc1\u79fb\u5904\u7406\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u4ee5\uff1a"}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsx)(r.li,{children:"\u4f7f\u7528\u539f\u59cb SQL \u6267\u884c\uff1a"}),"\n"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// \u6267\u884c\u590d\u6742\u7684\u53d8\u66f4\r\nresult, err := db.Exec(context.Background(), \r\n    "ALTER TABLE users RENAME COLUMN old_name TO new_name")\n'})}),"\n",(0,d.jsxs)(r.ol,{start:"2",children:["\n",(0,d.jsx)(r.li,{children:"\u5206\u6b65\u6267\u884c\u8fc1\u79fb\uff1a"}),"\n"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-go",children:'// 1. \u521b\u5efa\u65b0\u7ed3\u6784\u7684\u8868\r\nerr = db.MigrateModel(context.Background(), &NewModel{})\r\n\r\n// 2. \u8fc1\u79fb\u6570\u636e\r\n_, err = db.Exec(context.Background(), \r\n    "INSERT INTO new_table SELECT * FROM old_table")\r\n\r\n// 3. \u5220\u9664\u65e7\u8868\r\n_, err = db.Exec(context.Background(), "DROP TABLE old_table")\n'})}),"\n",(0,d.jsx)(r.h2,{id:"\u8fc1\u79fb\u9650\u5236",children:"\u8fc1\u79fb\u9650\u5236"}),"\n",(0,d.jsx)(r.p,{children:"\u7406\u89e3\u81ea\u52a8\u8fc1\u79fb\u7684\u4e00\u4e9b\u9650\u5236\u662f\u5f88\u91cd\u8981\u7684\uff1a"}),"\n",(0,d.jsxs)(r.ol,{children:["\n",(0,d.jsxs)(r.li,{children:["\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u65e0\u6cd5\u667a\u80fd\u5904\u7406\u6240\u6709\u7c7b\u578b\u7684\u53d8\u66f4"}),"\uff1a\u91cd\u547d\u540d\u8868/\u5217\u3001\u66f4\u6539\u4e3b\u952e\u7b49\u53ef\u80fd\u9700\u8981\u624b\u52a8\u5904\u7406\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(r.li,{children:["\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u4e0d\u540c\u6570\u636e\u5e93\u5f15\u64ce\u6709\u4e0d\u540c\u9650\u5236"}),"\uff1a\u4f8b\u5982\uff0cSQLite \u5bf9 ALTER TABLE \u64cd\u4f5c\u6709\u4e25\u683c\u9650\u5236\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(r.li,{children:["\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u4e0d\u80fd\u5904\u7406\u590d\u6742\u7684\u6570\u636e\u8f6c\u6362"}),"\uff1a\u5982\u679c\u5217\u7c7b\u578b\u53d8\u66f4\u9700\u8981\u6570\u636e\u8f6c\u6362\uff0c\u60a8\u9700\u8981\u624b\u52a8\u5904\u7406\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(r.li,{children:["\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.strong,{children:"\u65e0\u6cd5\u56de\u6eda"}),"\uff1aWebFrame ORM \u5f53\u524d\u4e0d\u63d0\u4f9b\u81ea\u52a8\u56de\u6eda\u8fc1\u79fb\u7684\u529f\u80fd\uff0c\u56e0\u6b64\u5907\u4efd\u975e\u5e38\u91cd\u8981\u3002"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>s});var l=n(6540);const d={},i=l.createContext(d);function t(e){const r=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),l.createElement(i.Provider,{value:r},e.children)}}}]);