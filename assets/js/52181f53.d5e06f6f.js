"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[432],{8453:(r,e,n)=>{n.d(e,{R:()=>i,x:()=>t});var s=n(6540);const l={},d=s.createContext(l);function i(r){const e=s.useContext(d);return s.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function t(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(l):r.components||l:i(r.components),s.createElement(d.Provider,{value:e},r.children)}},9599:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>o,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"orm/advanced/sharding","title":"Sharding","description":"WebFrame ORM \u63d0\u4f9b\u4e86\u5bf9\u6570\u636e\u5206\u7247\u7684\u652f\u6301\uff0c\u4ee5\u6784\u5efa\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u6269\u5c55\u7684\u6570\u636e\u5e93\u8bbf\u95ee\u5c42\u3002","source":"@site/docs/orm/advanced/sharding.md","sourceDirName":"orm/advanced","slug":"/orm/advanced/sharding","permalink":"/fyer-webframe/docs/orm/advanced/sharding","draft":false,"unlisted":false,"editUrl":"https://github.com/fyerfyer/fyer-webframe/tree/main/docs/orm/advanced/sharding.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u94a9\u5b50\u51fd\u6570","permalink":"/fyer-webframe/docs/orm/advanced/hook"},"next":{"title":"Transaction","permalink":"/fyer-webframe/docs/orm/advanced/transaction"}}');var l=n(4848),d=n(8453);const i={},t="Sharding",a={},c=[{value:"\u5206\u7247\u57fa\u7840\u6982\u5ff5",id:"\u5206\u7247\u57fa\u7840\u6982\u5ff5",level:2},{value:"\u4ec0\u4e48\u662f\u6570\u636e\u5206\u7247\uff1f",id:"\u4ec0\u4e48\u662f\u6570\u636e\u5206\u7247",level:3},{value:"\u5173\u952e\u6982\u5ff5",id:"\u5173\u952e\u6982\u5ff5",level:3},{value:"\u603b\u4f53\u67b6\u6784",id:"\u603b\u4f53\u67b6\u6784",level:2},{value:"\u5173\u952e\u8bbe\u8ba1\u6a21\u5f0f",id:"\u5173\u952e\u8bbe\u8ba1\u6a21\u5f0f",level:2},{value:"1. \u7b56\u7565\u6a21\u5f0f",id:"1-\u7b56\u7565\u6a21\u5f0f",level:3},{value:"2. \u9002\u914d\u5668\u6a21\u5f0f",id:"2-\u9002\u914d\u5668\u6a21\u5f0f",level:3},{value:"3. \u4ee3\u7406\u6a21\u5f0f",id:"3-\u4ee3\u7406\u6a21\u5f0f",level:3},{value:"4. \u5efa\u9020\u8005\u6a21\u5f0f",id:"4-\u5efa\u9020\u8005\u6a21\u5f0f",level:3},{value:"\u5bf9\u8c61\u4f9d\u8d56\u5173\u7cfb",id:"\u5bf9\u8c61\u4f9d\u8d56\u5173\u7cfb",level:2},{value:"\u5de5\u4f5c\u6d41\u7a0b",id:"\u5de5\u4f5c\u6d41\u7a0b",level:2},{value:"\u5206\u7247\u7b56\u7565",id:"\u5206\u7247\u7b56\u7565",level:2},{value:"1. \u54c8\u5e0c\u5206\u7247\u7b56\u7565\uff08Hash Strategy\uff09",id:"1-\u54c8\u5e0c\u5206\u7247\u7b56\u7565hash-strategy",level:3},{value:"2. \u8303\u56f4\u5206\u7247\u7b56\u7565\uff08Range Strategy\uff09",id:"2-\u8303\u56f4\u5206\u7247\u7b56\u7565range-strategy",level:3},{value:"3. \u65e5\u671f\u5206\u7247\u7b56\u7565\uff08Date Strategy\uff09",id:"3-\u65e5\u671f\u5206\u7247\u7b56\u7565date-strategy",level:3},{value:"4. \u53d6\u6a21\u5206\u7247\u7b56\u7565\uff08Mod Strategy\uff09",id:"4-\u53d6\u6a21\u5206\u7247\u7b56\u7565mod-strategy",level:3},{value:"\u914d\u7f6e\u5206\u7247",id:"\u914d\u7f6e\u5206\u7247",level:2},{value:"\u521b\u5efa\u5206\u7247\u6570\u636e\u5e93",id:"\u521b\u5efa\u5206\u7247\u6570\u636e\u5e93",level:3},{value:"\u901a\u8fc7\u5ba2\u6237\u7aef API \u4f7f\u7528\u5206\u7247",id:"\u901a\u8fc7\u5ba2\u6237\u7aef-api-\u4f7f\u7528\u5206\u7247",level:3},{value:"\u4f7f\u7528\u5206\u7247\u8fdb\u884c\u6570\u636e\u64cd\u4f5c",id:"\u4f7f\u7528\u5206\u7247\u8fdb\u884c\u6570\u636e\u64cd\u4f5c",level:2},{value:"\u67e5\u8be2\u64cd\u4f5c",id:"\u67e5\u8be2\u64cd\u4f5c",level:3},{value:"\u63d2\u5165\u64cd\u4f5c",id:"\u63d2\u5165\u64cd\u4f5c",level:3},{value:"\u66f4\u65b0\u64cd\u4f5c",id:"\u66f4\u65b0\u64cd\u4f5c",level:3},{value:"\u5220\u9664\u64cd\u4f5c",id:"\u5220\u9664\u64cd\u4f5c",level:3},{value:"\u8de8\u5206\u7247\u64cd\u4f5c",id:"\u8de8\u5206\u7247\u64cd\u4f5c",level:2},{value:"\u5728\u6240\u6709\u5206\u7247\u4e0a\u6267\u884c\u76f8\u540c\u64cd\u4f5c",id:"\u5728\u6240\u6709\u5206\u7247\u4e0a\u6267\u884c\u76f8\u540c\u64cd\u4f5c",level:3},{value:"\u5728\u7279\u5b9a\u5206\u7247\u4e0a\u6267\u884c\u64cd\u4f5c",id:"\u5728\u7279\u5b9a\u5206\u7247\u4e0a\u6267\u884c\u64cd\u4f5c",level:3},{value:"\u5206\u7247\u8def\u7531\u539f\u7406",id:"\u5206\u7247\u8def\u7531\u539f\u7406",level:2},{value:"\u8def\u7531\u8fc7\u7a0b\u793a\u4f8b",id:"\u8def\u7531\u8fc7\u7a0b\u793a\u4f8b",level:3},{value:"\u5206\u7247\u4e2d\u7684\u4e8b\u52a1\u5904\u7406",id:"\u5206\u7247\u4e2d\u7684\u4e8b\u52a1\u5904\u7406",level:2},{value:"\u5355\u5206\u7247\u4e8b\u52a1",id:"\u5355\u5206\u7247\u4e8b\u52a1",level:3},{value:"\u8de8\u5206\u7247\u4e8b\u52a1\u6ce8\u610f\u4e8b\u9879",id:"\u8de8\u5206\u7247\u4e8b\u52a1\u6ce8\u610f\u4e8b\u9879",level:3},{value:"\u5206\u7247\u7edf\u8ba1\u548c\u76d1\u63a7",id:"\u5206\u7247\u7edf\u8ba1\u548c\u76d1\u63a7",level:2}];function h(r){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...r.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"sharding",children:"Sharding"})}),"\n",(0,l.jsx)(e.p,{children:"WebFrame ORM \u63d0\u4f9b\u4e86\u5bf9\u6570\u636e\u5206\u7247\u7684\u652f\u6301\uff0c\u4ee5\u6784\u5efa\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u6269\u5c55\u7684\u6570\u636e\u5e93\u8bbf\u95ee\u5c42\u3002"}),"\n",(0,l.jsx)(e.h2,{id:"\u5206\u7247\u57fa\u7840\u6982\u5ff5",children:"\u5206\u7247\u57fa\u7840\u6982\u5ff5"}),"\n",(0,l.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u6570\u636e\u5206\u7247",children:"\u4ec0\u4e48\u662f\u6570\u636e\u5206\u7247\uff1f"}),"\n",(0,l.jsx)(e.p,{children:"\u6570\u636e\u5206\u7247\u662f\u4e00\u79cd\u6c34\u5e73\u5206\u533a\u6280\u672f\uff0c\u5b83\u5c06\u5355\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u5206\u5e03\u5230\u591a\u4e2a\u7269\u7406\u6570\u636e\u5e93\u6216\u8868\u4e2d\u3002\u901a\u8fc7\u6570\u636e\u5206\u7247\uff0c\u60a8\u53ef\u4ee5\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd"}),"\n",(0,l.jsx)(e.li,{children:"\u589e\u5f3a\u7cfb\u7edf\u53ef\u6269\u5c55\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u66f4\u597d\u5730\u7ba1\u7406\u5927\u6570\u636e\u91cf"}),"\n",(0,l.jsx)(e.li,{children:"\u51cf\u5c11\u5355\u4e2a\u8282\u70b9\u7684\u8d1f\u8f7d"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u5173\u952e\u6982\u5ff5",children:"\u5173\u952e\u6982\u5ff5"}),"\n",(0,l.jsx)(e.p,{children:"\u5728 WebFrame ORM \u7684\u5206\u7247\u7cfb\u7edf\u4e2d\uff0c\u6709\u51e0\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u952e\uff08Shard Key\uff09"}),"\uff1a\u7528\u4e8e\u786e\u5b9a\u6570\u636e\u5e94\u8def\u7531\u5230\u54ea\u4e2a\u5206\u7247\u7684\u5b57\u6bb5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u7b56\u7565\uff08Sharding Strategy\uff09"}),"\uff1a\u51b3\u5b9a\u5982\u4f55\u57fa\u4e8e\u5206\u7247\u952e\u5206\u914d\u6570\u636e\u7684\u7b97\u6cd5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u8def\u7531\uff08Shard Router\uff09"}),"\uff1a\u8d1f\u8d23\u8ba1\u7b97\u5177\u4f53\u8bb0\u5f55\u5e94\u5b58\u50a8\u5728\u54ea\u4e2a\u5206\u7247\u7684\u7ec4\u4ef6"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u8868\uff08Sharded Table\uff09"}),"\uff1a\u8de8\u591a\u4e2a\u6570\u636e\u5e93\u5b9e\u4f8b\u7684\u903b\u8f91\u4e0a\u76f8\u540c\u7684\u8868"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u603b\u4f53\u67b6\u6784",children:"\u603b\u4f53\u67b6\u6784"}),"\n",(0,l.jsx)(e.p,{children:"\u5206\u7247\u7cfb\u7edf\u7684\u6574\u4f53\u67b6\u6784\u9075\u5faa\u5206\u5c42\u8bbe\u8ba1\u539f\u5219\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5185\u90e8\u5b9e\u73b0\u5c42"})," (",(0,l.jsx)(e.code,{children:"internal/sharding"}),"): \u63d0\u4f9b\u6838\u5fc3\u7684\u5206\u7247\u7b97\u6cd5\u548c\u8def\u7531\u903b\u8f91"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5bf9\u5916 API \u5c42"})," (orm \u5305): \u63d0\u4f9b\u4e0e ORM \u96c6\u6210\u7684\u7528\u6237\u53cb\u597d\u63a5\u53e3"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4e2d\u95f4\u4ef6\u5c42"}),": \u901a\u8fc7\u4e2d\u95f4\u4ef6\u81ea\u52a8\u62e6\u622a\u548c\u8f6c\u53d1\u67e5\u8be2\u5230\u6b63\u786e\u7684\u5206\u7247"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                  \u7528\u6237\u5e94\u7528\u4ee3\u7801                        \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                        \u2502\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502         ShardingClient / Collection API             \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                        \u2502\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502               ShardingMiddleware                    \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                        \u2502\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                   ShardingDB                        \u2502\r\n\u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\r\n   \u2502                                             \u2502\r\n\u250c\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\r\n\u2502    ShardingManager     \u2502   \u2502     DefaultRouter     \u2502\r\n\u2514\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\r\n   \u2502                                            \u2502\r\n\u250c\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                 \u5206\u7247\u7b56\u7565 (Strategy)                \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\r\n\u2502  \u2502HashStrategy\u2502RangeStrategy\u2502DateStrategy\u2502ModStrategy\u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2518\r\n                                                   \u2502\r\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2510\r\n\u2502                  \u7269\u7406\u5206\u7247\u6570\u636e\u5e93                    \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5173\u952e\u8bbe\u8ba1\u6a21\u5f0f",children:"\u5173\u952e\u8bbe\u8ba1\u6a21\u5f0f"}),"\n",(0,l.jsx)(e.p,{children:"WebFrame ORM \u5206\u7247\u7cfb\u7edf\u91c7\u7528\u591a\u79cd\u8bbe\u8ba1\u6a21\u5f0f\u6765\u5b9e\u73b0\u7075\u6d3b\u6027\u548c\u53ef\u6269\u5c55\u6027\uff1a"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u7b56\u7565\u6a21\u5f0f",children:"1. \u7b56\u7565\u6a21\u5f0f"}),"\n",(0,l.jsxs)(e.p,{children:["\u5206\u7247\u7b56\u7565\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\uff0c\u901a\u8fc7 ",(0,l.jsx)(e.code,{children:"Strategy"})," \u63a5\u53e3\u7edf\u4e00\u5b9a\u4e49\u8def\u7531\u884c\u4e3a\uff0c\u5e76\u63d0\u4f9b\u591a\u79cd\u5177\u4f53\u5b9e\u73b0\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:"type Strategy interface {\r\n    Route(key interface{}) (dbIndex, tableIndex int, err error)\r\n    GetShardName(dbIndex, tableIndex int) (dbName, tableName string, err error)\r\n}\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u56db\u79cd\u7b56\u7565\u5b9e\u73b0\uff08\u54c8\u5e0c\u3001\u8303\u56f4\u3001\u65e5\u671f\u3001\u53d6\u6a21\uff09\u90fd\u7ee7\u627f\u81ea ",(0,l.jsx)(e.code,{children:"BaseStrategy"})," \u57fa\u7c7b\uff0c\u5e76\u63d0\u4f9b\u5404\u81ea\u7684\u8def\u7531\u7b97\u6cd5\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"2-\u9002\u914d\u5668\u6a21\u5f0f",children:"2. \u9002\u914d\u5668\u6a21\u5f0f"}),"\n",(0,l.jsxs)(e.p,{children:["\u901a\u8fc7 ",(0,l.jsx)(e.code,{children:"shardingStrategyAdapter"})," \u5c06\u5185\u90e8\u7684\u5206\u7247\u7b56\u7565\u9002\u914d\u4e3a\u5bf9\u5916\u7684 ",(0,l.jsx)(e.code,{children:"ShardingStrategy"})," \u63a5\u53e3\uff0c\u5b9e\u73b0\u5185\u5916\u5c42\u7684\u89e3\u8026\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"3-\u4ee3\u7406\u6a21\u5f0f",children:"3. \u4ee3\u7406\u6a21\u5f0f"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"ShardedDB"})," \u4f5c\u4e3a\u666e\u901a ",(0,l.jsx)(e.code,{children:"DB"})," \u7684\u4ee3\u7406\uff0c\u62e6\u622a\u67e5\u8be2\u8bf7\u6c42\u5e76\u5c06\u5176\u8def\u7531\u5230\u6b63\u786e\u7684\u5206\u7247\uff0c\u5bf9\u8c03\u7528\u65b9\u900f\u660e\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"4-\u5efa\u9020\u8005\u6a21\u5f0f",children:"4. \u5efa\u9020\u8005\u6a21\u5f0f"}),"\n",(0,l.jsx)(e.p,{children:"\u6240\u6709\u5206\u7247\u7b56\u7565\u548c\u8def\u7531\u5668\u90fd\u4f7f\u7528\u5efa\u9020\u8005\u6a21\u5f0f\uff0c\u901a\u8fc7\u6d41\u7545\u7684 API \u8fdb\u884c\u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'hashStrategy := WithHashStrategy("user_db_", 4, "user_", 8, "UserID")\r\n\r\nrouter := NewShardingRouter().\r\n    WithCacheSize(1000).\r\n    WithCacheExpiration(time.Minute)\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u5bf9\u8c61\u4f9d\u8d56\u5173\u7cfb",children:"\u5bf9\u8c61\u4f9d\u8d56\u5173\u7cfb"}),"\n",(0,l.jsx)(e.p,{children:"\u5206\u7247\u7cfb\u7edf\u7684\u4e3b\u8981\u5bf9\u8c61\u53ca\u5176\u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"ShardingDB\r\n  \u251c\u2500\u2500 \u539f\u59cbDB (\u9ed8\u8ba4\u6570\u636e\u5e93)\r\n  \u251c\u2500\u2500 ShardingManager\r\n  \u2502     \u251c\u2500\u2500 \u5206\u7247DB\u6620\u5c04 (shards map[string]*DB)\r\n  \u2502     \u2514\u2500\u2500 Router\r\n  \u2514\u2500\u2500 ShardingMiddleware\r\n        \u2514\u2500\u2500 \u63d0\u53d6\u5206\u7247\u952e\u5e76\u8def\u7531\u67e5\u8be2\r\n\r\nRouter\r\n  \u251c\u2500\u2500 \u6a21\u578b\u4fe1\u606f\u6620\u5c04 (models map[string]*ModelInfo)\r\n  \u251c\u2500\u2500 \u8def\u7531\u7f13\u5b58 (routeCache sync.Map)\r\n  \u2514\u2500\u2500 Strategy\u7b56\u7565\u6620\u5c04\r\n\r\nStrategy\r\n  \u251c\u2500\u2500 BaseStrategy (\u5171\u4eab\u57fa\u7840\u5b9e\u73b0)\r\n  \u2502     \u251c\u2500\u2500 HashStrategy (\u57fa\u4e8e\u54c8\u5e0c\u5206\u7247)\r\n  \u2502     \u251c\u2500\u2500 RangeStrategy (\u57fa\u4e8e\u8303\u56f4\u5206\u7247)\r\n  \u2502     \u251c\u2500\u2500 DateStrategy (\u57fa\u4e8e\u65e5\u671f\u5206\u7247)\r\n  \u2502     \u2514\u2500\u2500 ModStrategy (\u57fa\u4e8e\u53d6\u6a21\u5206\u7247)\r\n  \u2514\u2500\u2500 \u8ba1\u7b97\u5206\u7247\u4f4d\u7f6e\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5de5\u4f5c\u6d41\u7a0b",children:"\u5de5\u4f5c\u6d41\u7a0b"}),"\n",(0,l.jsx)(e.p,{children:"\u4e00\u4e2a\u5178\u578b\u7684\u5206\u7247\u67e5\u8be2\u5904\u7406\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u67e5\u8be2\u62e6\u622a"}),"\uff1a",(0,l.jsx)(e.code,{children:"ShardingMiddleware"})," \u62e6\u622a\u6570\u636e\u5e93\u67e5\u8be2"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u952e\u63d0\u53d6"}),"\uff1a\u4ece\u67e5\u8be2\u6761\u4ef6\u4e2d\u63d0\u53d6\u5206\u7247\u952e\u503c"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u8def\u7531\u8ba1\u7b97"}),"\uff1a\u4f7f\u7528\u6ce8\u518c\u7684\u5206\u7247\u7b56\u7565\u8ba1\u7b97\u76ee\u6807\u5206\u7247\u4f4d\u7f6e"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7f13\u5b58\u68c0\u67e5"}),"\uff1a\u68c0\u67e5\u8def\u7531\u7f13\u5b58\uff0c\u907f\u514d\u91cd\u590d\u8ba1\u7b97"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"SQL \u91cd\u5199"}),"\uff1a\u6839\u636e\u5206\u7247\u7ed3\u679c\u91cd\u5199\u67e5\u8be2\u7684\u8868\u540d"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u9009\u62e9"}),"\uff1a\u9009\u62e9\u6b63\u786e\u7684\u5206\u7247\u6570\u636e\u5e93\u8fde\u63a5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6267\u884c\u67e5\u8be2"}),"\uff1a\u5728\u76ee\u6807\u5206\u7247\u4e0a\u6267\u884c\u4fee\u6539\u540e\u7684\u67e5\u8be2"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7ed3\u679c\u8fd4\u56de"}),"\uff1a\u5c06\u67e5\u8be2\u7ed3\u679c\u8fd4\u56de\u7ed9\u8c03\u7528\u65b9"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u5206\u7247\u7b56\u7565",children:"\u5206\u7247\u7b56\u7565"}),"\n",(0,l.jsx)(e.p,{children:"WebFrame ORM \u63d0\u4f9b\u4e86\u56db\u79cd\u5185\u7f6e\u5206\u7247\u7b56\u7565\uff0c\u6bcf\u79cd\u7b56\u7565\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\uff1a"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u54c8\u5e0c\u5206\u7247\u7b56\u7565hash-strategy",children:"1. \u54c8\u5e0c\u5206\u7247\u7b56\u7565\uff08Hash Strategy\uff09"}),"\n",(0,l.jsx)(e.p,{children:"\u57fa\u4e8e\u5206\u7247\u952e\u7684\u54c8\u5e0c\u503c\u5c06\u6570\u636e\u5747\u5300\u5206\u5e03\u5230\u5404\u4e2a\u5206\u7247\u3002"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a\u9700\u8981\u5747\u5300\u5206\u5e03\u6570\u636e\uff0c\u4e14\u65e0\u9700\u6309\u8303\u56f4\u67e5\u8be2\u65f6\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u57fa\u4e8e\u54c8\u5e0c\u7684\u5206\u7247\u7b56\u7565\r\nhashStrategy := WithHashStrategy("user_db_", 4, "user_", 8, "UserID")\r\n\r\n// \u53c2\u6570\u8bf4\u660e:\r\n// - "user_db_" - \u6570\u636e\u5e93\u540d\u79f0\u524d\u7f00\r\n// - 4 - \u6570\u636e\u5e93\u6570\u91cf\r\n// - "user_" - \u8868\u540d\u524d\u7f00\r\n// - 8 - \u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u8868\u6570\u91cf\r\n// - "UserID" - \u5206\u7247\u952e\n'})}),"\n",(0,l.jsx)(e.h3,{id:"2-\u8303\u56f4\u5206\u7247\u7b56\u7565range-strategy",children:"2. \u8303\u56f4\u5206\u7247\u7b56\u7565\uff08Range Strategy\uff09"}),"\n",(0,l.jsx)(e.p,{children:"\u57fa\u4e8e\u5206\u7247\u952e\u7684\u6570\u503c\u8303\u56f4\u5c06\u6570\u636e\u5206\u914d\u5230\u5404\u4e2a\u5206\u7247\u3002"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a\u9700\u8981\u57fa\u4e8e\u8fde\u7eed\u8303\u56f4\u503c\u8fdb\u884c\u9ad8\u6548\u67e5\u8be2\u65f6\uff0c\u4f8b\u5982\u6309\u65e5\u671f\u8303\u56f4\u67e5\u8be2\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u57fa\u4e8e\u8303\u56f4\u7684\u5206\u7247\u7b56\u7565\r\nranges := []int64{1000, 2000, 3000, 4000} // \u8303\u56f4\u8fb9\u754c\u503c\r\nrangeStrategy := WithRangeStrategy("order_db_", 4, "order_", 5, "OrderID", ranges)\r\n\r\n// \u4f8b\u5982\uff0cID\u5728[0,1000)\u8def\u7531\u5230\u5206\u72470\uff0c[1000,2000)\u8def\u7531\u5230\u5206\u72471\uff0c\u4f9d\u6b64\u7c7b\u63a8\n'})}),"\n",(0,l.jsx)(e.h3,{id:"3-\u65e5\u671f\u5206\u7247\u7b56\u7565date-strategy",children:"3. \u65e5\u671f\u5206\u7247\u7b56\u7565\uff08Date Strategy\uff09"}),"\n",(0,l.jsx)(e.p,{children:"\u57fa\u4e8e\u65e5\u671f\u5b57\u6bb5\u5c06\u6570\u636e\u5206\u914d\u5230\u5404\u4e2a\u5206\u7247\uff0c\u652f\u6301\u6309\u65e5\u3001\u5468\u3001\u6708\u3001\u5e74\u5206\u7247\u3002"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a\u65f6\u95f4\u5e8f\u5217\u6570\u636e\uff0c\u5982\u65e5\u5fd7\u3001\u4ea4\u6613\u8bb0\u5f55\u7b49\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u57fa\u4e8e\u65e5\u671f\u7684\u5206\u7247\u7b56\u7565\r\ndateStrategy := WithDateStrategy("log_db_", 4, "log_", 12, "CreateTime", "monthly").\r\n    WithStartTime(time.Date(2023, 1, 1, 0, 0, 0, 0, time.UTC))\r\n\r\n// \u65e5\u671f\u683c\u5f0f\u652f\u6301: "daily", "weekly", "monthly", "yearly"\n'})}),"\n",(0,l.jsx)(e.h3,{id:"4-\u53d6\u6a21\u5206\u7247\u7b56\u7565mod-strategy",children:"4. \u53d6\u6a21\u5206\u7247\u7b56\u7565\uff08Mod Strategy\uff09"}),"\n",(0,l.jsx)(e.p,{children:"\u4f7f\u7528\u5206\u7247\u952e\u5bf9\u5206\u7247\u6570\u91cf\u53d6\u6a21\uff0c\u662f\u4e00\u79cd\u7b80\u5355\u4f46\u6709\u6548\u7684\u5206\u7247\u65b9\u6cd5\u3002"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573a\u666f"}),"\uff1a\u9700\u8981\u7b80\u5355\u3001\u786e\u5b9a\u6027\u5206\u7247\u89c4\u5219\uff0c\u4e14\u6570\u636e\u5747\u5300\u5206\u5e03\u65f6\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u57fa\u4e8e\u53d6\u6a21\u7684\u5206\u7247\u7b56\u7565\r\nmodStrategy := WithModStrategy("product_db_", 3, "product_", 5, "ProductID")\r\n\r\n// \u4f8b\u5982\uff0cID = 1001: \r\n// \u6570\u636e\u5e93\u7d22\u5f15 = 1001 % 3 = 1 (\u6570\u636e\u5e93\u540d\u4e3a product_db_1)\r\n// \u8868\u7d22\u5f15 = (1001 / 3) % 5 = 3 (\u8868\u540d\u4e3a product_3)\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u914d\u7f6e\u5206\u7247",children:"\u914d\u7f6e\u5206\u7247"}),"\n",(0,l.jsx)(e.h3,{id:"\u521b\u5efa\u5206\u7247\u6570\u636e\u5e93",children:"\u521b\u5efa\u5206\u7247\u6570\u636e\u5e93"}),"\n",(0,l.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"NewShardingDB"})," \u521b\u5efa\u4e00\u4e2a\u652f\u6301\u5206\u7247\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// 1. \u521b\u5efa\u57fa\u7840\u6570\u636e\u5e93\u8fde\u63a5\r\ndb, err := orm.OpenDB("mysql", "root:password@tcp(localhost:3306)/default_db", "mysql")\r\nif err != nil {\r\n    log.Fatal(err)\r\n}\r\n\r\n// 2. \u521b\u5efa\u8def\u7531\u5668\r\nrouter := orm.NewShardingRouter()\r\n\r\n// 3. \u521b\u5efa\u5206\u7247\u6570\u636e\u5e93\r\nshardDB := orm.NewShardingDB(db, router)\r\n\r\n// 4. \u6ce8\u518c\u5206\u7247\u7b56\u7565\r\nshardDB.RegisterShardStrategy("User", \r\n    orm.WithHashStrategy("user_db_", 4, "user_", 8, "UserID"), \r\n    "user_db_0") // \u9ed8\u8ba4\u5206\u7247\u6570\u636e\u5e93\r\n\r\n// 5. \u914d\u7f6e\u5206\u7247\u8fde\u63a5\r\nerr = shardDB.ConfigureShards(map[string]orm.ShardConfig{\r\n    "user_db_0": {\r\n        Driver: "mysql",\r\n        DSN: "root:password@tcp(localhost:3306)/user_db_0",\r\n        MaxIdleConn: 10,\r\n        MaxOpenConn: 100,\r\n    },\r\n    "user_db_1": {\r\n        Driver: "mysql",\r\n        DSN: "root:password@tcp(localhost:3306)/user_db_1",\r\n        MaxIdleConn: 10,\r\n        MaxOpenConn: 100,\r\n    },\r\n    // \u66f4\u591a\u5206\u7247\u914d\u7f6e...\r\n})\r\nif err != nil {\r\n    log.Fatal(err)\r\n}\r\n\r\n// 6. \u542f\u7528\u5206\u7247\r\nshardDB.EnableSharding()\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u901a\u8fc7\u5ba2\u6237\u7aef-api-\u4f7f\u7528\u5206\u7247",children:"\u901a\u8fc7\u5ba2\u6237\u7aef API \u4f7f\u7528\u5206\u7247"}),"\n",(0,l.jsx)(e.p,{children:"\u4f7f\u7528\u5ba2\u6237\u7aef API \u53ef\u4ee5\u66f4\u7b80\u6d01\u5730\u64cd\u4f5c\u5206\u7247\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u521b\u5efa\u5206\u7247\u5ba2\u6237\u7aef\r\nclient := db.NewClient()\r\nshardClient := client.AsShardingClient()\r\n\r\n// \u6ce8\u518c\u5206\u7247\u7b56\u7565\r\nshardClient.RegisterShardStrategy("Order", \r\n    orm.WithModStrategy("order_db_", 3, "order_", 5, "OrderID"),\r\n    "order_db_0")\r\n\r\n// \u4f7f\u7528\u5206\u7247\u96c6\u5408\r\norderCollection := shardClient.ShardedCollection(&Order{})\r\n\r\n// \u57fa\u4e8e\u5206\u7247\u952e\u67e5\u8be2\r\norder, err := orderCollection.Find(ctx, orm.Col("OrderID").Eq(1001))\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u4f7f\u7528\u5206\u7247\u8fdb\u884c\u6570\u636e\u64cd\u4f5c",children:"\u4f7f\u7528\u5206\u7247\u8fdb\u884c\u6570\u636e\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.h3,{id:"\u67e5\u8be2\u64cd\u4f5c",children:"\u67e5\u8be2\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u5206\u7247\u73af\u5883\u4e2d\u6267\u884c\u67e5\u8be2\uff0cORM \u4f1a\u81ea\u52a8\u8def\u7531\u5230\u6b63\u786e\u7684\u5206\u7247\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// 1. \u4f7f\u7528\u9009\u62e9\u5668 API\r\nuser, err := orm.RegisterSelector[User](shardDB).\r\n    Select().\r\n    Where(orm.Col("UserID").Eq(1001)).  // \u5305\u542b\u5206\u7247\u952e\u7684\u6761\u4ef6\r\n    Get(ctx)\r\n\r\n// 2. \u4f7f\u7528\u5ba2\u6237\u7aef API \r\nuserCollection := shardClient.Collection(&User{})\r\nuser, err := userCollection.Find(ctx, orm.Col("UserID").Eq(1001))\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u63d2\u5165\u64cd\u4f5c",children:"\u63d2\u5165\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.p,{children:"\u63d2\u5165\u65f6\u5fc5\u987b\u5305\u542b\u5206\u7247\u952e\u503c\u4ee5\u786e\u5b9a\u6570\u636e\u8def\u7531\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// 1. \u4f7f\u7528\u63d2\u5165\u5668 API\r\nnewUser := &User{UserID: 1002, Name: "Alice", Age: 30}\r\nresult, err := orm.RegisterInserter[User](shardDB).\r\n    Insert(nil, newUser).\r\n    Exec(ctx)\r\n\r\n// 2. \u4f7f\u7528\u5ba2\u6237\u7aef API\r\nuserCollection := shardClient.Collection(&User{})\r\nresult, err := userCollection.Insert(ctx, newUser)\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u66f4\u65b0\u64cd\u4f5c",children:"\u66f4\u65b0\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.p,{children:"\u66f4\u65b0\u64cd\u4f5c\u4e5f\u9700\u8981\u5206\u7247\u952e\u6765\u786e\u5b9a\u8def\u7531\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// 1. \u4f7f\u7528\u66f4\u65b0\u5668 API\r\nresult, err := orm.RegisterUpdater[User](shardDB).\r\n    Update().\r\n    Set(orm.Col("Age"), 31).\r\n    Where(orm.Col("UserID").Eq(1002)).  // \u5fc5\u987b\u5305\u542b\u5206\u7247\u952e\r\n    Exec(ctx)\r\n\r\n// 2. \u4f7f\u7528\u5ba2\u6237\u7aef API\r\nuserCollection := shardClient.Collection(&User{})\r\nresult, err := userCollection.Update(ctx, \r\n    map[string]interface{}{"Age": 31},\r\n    orm.Col("UserID").Eq(1002))\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u5220\u9664\u64cd\u4f5c",children:"\u5220\u9664\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.p,{children:"\u5220\u9664\u540c\u6837\u9700\u8981\u5206\u7247\u952e\u6765\u786e\u5b9a\u8def\u7531\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// 1. \u4f7f\u7528\u5220\u9664\u5668 API\r\nresult, err := orm.RegisterDeleter[User](shardDB).\r\n    Delete().\r\n    Where(orm.Col("UserID").Eq(1002)).  // \u5fc5\u987b\u5305\u542b\u5206\u7247\u952e\r\n    Exec(ctx)\r\n\r\n// 2. \u4f7f\u7528\u5ba2\u6237\u7aef API\r\nuserCollection := shardClient.Collection(&User{})\r\nresult, err := userCollection.Delete(ctx, orm.Col("UserID").Eq(1002))\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u8de8\u5206\u7247\u64cd\u4f5c",children:"\u8de8\u5206\u7247\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.p,{children:"\u6709\u65f6\u5019\u9700\u8981\u5728\u591a\u4e2a\u5206\u7247\u4e0a\u6267\u884c\u64cd\u4f5c\uff0cWebFrame ORM \u63d0\u4f9b\u4e86\u4fbf\u6377\u7684\u5de5\u5177\uff1a"}),"\n",(0,l.jsx)(e.h3,{id:"\u5728\u6240\u6709\u5206\u7247\u4e0a\u6267\u884c\u76f8\u540c\u64cd\u4f5c",children:"\u5728\u6240\u6709\u5206\u7247\u4e0a\u6267\u884c\u76f8\u540c\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u5728\u6240\u6709\u7528\u6237\u5206\u7247\u4e0a\u6267\u884c\u5206\u6790\u67e5\u8be2\r\nerrors := shardDB.ExecuteOnAllShards(ctx, func(db *orm.DB) error {\r\n    result, err := db.Exec(ctx, "ANALYZE TABLE user")\r\n    if err != nil {\r\n        return err\r\n    }\r\n    log.Printf("Analyzed table on shard: %v", result)\r\n    return nil\r\n})\r\n\r\n// \u68c0\u67e5\u662f\u5426\u6709\u9519\u8bef\u53d1\u751f\r\nfor i, err := range errors {\r\n    if err != nil {\r\n        log.Printf("Error on shard %d: %v", i, err)\r\n    }\r\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u5728\u7279\u5b9a\u5206\u7247\u4e0a\u6267\u884c\u64cd\u4f5c",children:"\u5728\u7279\u5b9a\u5206\u7247\u4e0a\u6267\u884c\u64cd\u4f5c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u5728\u7279\u5b9a\u5206\u7247\u4e0a\u6267\u884c\u64cd\u4f5c\r\nerr := shardClient.ExecuteOnShard(ctx, "user_db_1", func(db *orm.DB) error {\r\n    rows, err := db.Raw(ctx, "SELECT COUNT(*) FROM user_1")\r\n    if err != nil {\r\n        return err\r\n    }\r\n    defer rows.Close()\r\n    \r\n    var count int\r\n    if rows.Next() {\r\n        if err := rows.Scan(&count); err != nil {\r\n            return err\r\n        }\r\n    }\r\n    log.Printf("User count on shard user_db_1: %d", count)\r\n    return nil\r\n})\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u5206\u7247\u8def\u7531\u539f\u7406",children:"\u5206\u7247\u8def\u7531\u539f\u7406"}),"\n",(0,l.jsx)(e.p,{children:"WebFrame ORM \u5206\u7247\u7cfb\u7edf\u7684\u6838\u5fc3\u662f\u5176\u8def\u7531\u673a\u5236\uff0c\u5b83\u786e\u5b9a\u6570\u636e\u5e94\u8be5\u8def\u7531\u5230\u54ea\u4e2a\u5206\u7247\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u8def\u7531\u8ba1\u7b97"}),"\uff1a\u6839\u636e\u5206\u7247\u952e\u503c\u548c\u5206\u7247\u7b56\u7565\u8ba1\u7b97\u5206\u7247\u4f4d\u7f6e"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u8def\u7531\u7f13\u5b58"}),"\uff1a\u9ad8\u9891\u8def\u7531\u7ed3\u679c\u4f1a\u88ab\u7f13\u5b58\u4ee5\u63d0\u9ad8\u6027\u80fd"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u7247\u66ff\u6362"}),"\uff1a\u67e5\u8be2\u6267\u884c\u524d\u81ea\u52a8\u66ff\u6362\u8868\u540d\u548c\u6570\u636e\u5e93\u8fde\u63a5"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u8def\u7531\u8fc7\u7a0b\u793a\u4f8b",children:"\u8def\u7531\u8fc7\u7a0b\u793a\u4f8b"}),"\n",(0,l.jsx)(e.p,{children:"\u4ee5\u53d6\u6a21\u5206\u7247\u4e3a\u4f8b\uff0c\u8def\u7531\u8fc7\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5206\u7247\u952e\u503c: ",(0,l.jsx)(e.code,{children:"OrderID = 1001"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u4f7f\u7528\u53d6\u6a21\u7b56\u7565\uff1a","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u6570\u636e\u5e93\u7d22\u5f15 = ",(0,l.jsx)(e.code,{children:"1001 % 3 = 2"})," \u2192 \u9009\u62e9 ",(0,l.jsx)(e.code,{children:"order_db_2"})," \u5206\u7247"]}),"\n",(0,l.jsxs)(e.li,{children:["\u8868\u7d22\u5f15 = ",(0,l.jsx)(e.code,{children:"(1001 / 3) % 5 = 3"})," \u2192 \u9009\u62e9 ",(0,l.jsx)(e.code,{children:"order_3"})," \u8868"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\u66ff\u6362\u539f\u59cb SQL \u4e2d\u7684\u8868\u540d\uff1a",(0,l.jsx)(e.code,{children:"FROM order"})," \u2192 ",(0,l.jsx)(e.code,{children:"FROM order_3"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"order_db_2"})," \u5206\u7247\u8fde\u63a5\u6267\u884c\u67e5\u8be2"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u5206\u7247\u4e2d\u7684\u4e8b\u52a1\u5904\u7406",children:"\u5206\u7247\u4e2d\u7684\u4e8b\u52a1\u5904\u7406"}),"\n",(0,l.jsx)(e.p,{children:"\u5206\u7247\u73af\u5883\u4e2d\u7684\u4e8b\u52a1\u5177\u6709\u7279\u6b8a\u6027\uff0c\u56e0\u4e3a\u5b83\u4eec\u901a\u5e38\u9700\u8981\u8de8\u591a\u4e2a\u6570\u636e\u5e93\u5b9e\u4f8b\uff1a"}),"\n",(0,l.jsx)(e.h3,{id:"\u5355\u5206\u7247\u4e8b\u52a1",children:"\u5355\u5206\u7247\u4e8b\u52a1"}),"\n",(0,l.jsx)(e.p,{children:"\u5982\u679c\u4e8b\u52a1\u53ea\u6d89\u53ca\u5355\u4e2a\u5206\u7247\uff0cWebFrame ORM \u4f1a\u81ea\u52a8\u5904\u7406\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u5728\u5355\u4e2a\u5206\u7247\u4e0a\u7684\u4e8b\u52a1\r\nerr := shardDB.Tx(ctx, func(tx *orm.Tx) error {\r\n    // \u8fd9\u4e9b\u64cd\u4f5c\u5728\u540c\u4e00\u4e2a\u5206\u7247\u4e0a\uff0c\u652f\u6301\u6807\u51c6\u4e8b\u52a1\r\n    result1, err := orm.RegisterUpdater[Order](tx).\r\n        Update().\r\n        Set(orm.Col("Status"), "processing").\r\n        Where(orm.Col("OrderID").Eq(1001)).\r\n        Exec(ctx)\r\n    if err != nil {\r\n        return err  // \u81ea\u52a8\u56de\u6eda\r\n    }\r\n    \r\n    result2, err := orm.RegisterInserter[OrderLog](tx).\r\n        Insert(nil, &OrderLog{\r\n            OrderID: 1001,\r\n            Action: "status_change",\r\n            Time: time.Now(),\r\n        }).\r\n        Exec(ctx)\r\n    if err != nil {\r\n        return err  // \u81ea\u52a8\u56de\u6eda\r\n    }\r\n    \r\n    return nil  // \u63d0\u4ea4\u4e8b\u52a1\r\n}, nil)\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u8de8\u5206\u7247\u4e8b\u52a1\u6ce8\u610f\u4e8b\u9879",children:"\u8de8\u5206\u7247\u4e8b\u52a1\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsx)(e.p,{children:"WebFrame ORM \u4e0d\u76f4\u63a5\u652f\u6301\u8de8\u5206\u7247\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u56e0\u4e3a\u8fd9\u9700\u8981\u66f4\u590d\u6742\u7684\u534f\u8c03\u673a\u5236\u3002\u5bf9\u4e8e\u8de8\u5206\u7247\u573a\u666f\uff0c\u60a8\u9700\u8981\u5b9e\u73b0\u5e94\u7528\u5c42\u903b\u8f91\u6765\u5904\u7406\u6570\u636e\u4e00\u81f4\u6027\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u9636\u6bb5\u63d0\u4ea4\u6a21\u5f0f"}),"\uff1a\u4f7f\u7528\u51c6\u5907-\u63d0\u4ea4-\u786e\u8ba4\u9636\u6bb5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6700\u7ec8\u4e00\u81f4\u6027\u6a21\u5f0f"}),"\uff1a\u4f7f\u7528\u6d88\u606f\u961f\u5217\u6216\u4e8b\u4ef6\u7cfb\u7edf\u786e\u4fdd\u6570\u636e\u6700\u7ec8\u4e00\u81f4"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u8865\u507f\u4e8b\u52a1\u6a21\u5f0f"}),"\uff1a\u5f53\u90e8\u5206\u64cd\u4f5c\u5931\u8d25\u65f6\u6267\u884c\u8865\u507f\u64cd\u4f5c"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u5206\u7247\u7edf\u8ba1\u548c\u76d1\u63a7",children:"\u5206\u7247\u7edf\u8ba1\u548c\u76d1\u63a7"}),"\n",(0,l.jsx)(e.p,{children:"WebFrame ORM \u5206\u7247\u7cfb\u7edf\u63d0\u4f9b\u4e86\u7edf\u8ba1\u4fe1\u606f\uff0c\u5e2e\u52a9\u60a8\u76d1\u63a7\u5206\u7247\u6027\u80fd\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-go",children:'// \u83b7\u53d6\u5206\u7247\u7edf\u8ba1\u4fe1\u606f\r\nstats := shardDB.GetShardingManager().GetStats()\r\n\r\n// \u67e5\u770b\u5404\u5206\u7247\u4f7f\u7528\u60c5\u51b5\r\nfor shard, count := range stats.RouteCount {\r\n    log.Printf("Shard %s: %d requests", shard, count)\r\n}\r\n\r\n// \u67e5\u770b\u7f13\u5b58\u547d\u4e2d\u7387\r\ncacheHitRate := float64(stats.CacheHit) / float64(stats.CacheHit + stats.CacheMiss)\r\nlog.Printf("Route cache hit rate: %.2f%%", cacheHitRate * 100)\r\n\r\n// \u67e5\u770b\u6700\u540e\u8bbf\u95ee\u65f6\u95f4\r\nfor shard, lastAccess := range stats.LastAccessTime {\r\n    log.Printf("Shard %s last access: %v", shard, lastAccess)\r\n}\n'})})]})}function o(r={}){const{wrapper:e}={...(0,d.R)(),...r.components};return e?(0,l.jsx)(e,{...r,children:(0,l.jsx)(h,{...r})}):h(r)}}}]);